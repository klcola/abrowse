<!DOCTYPE html>
<html lang="zh_CN" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="ABrowse - Advanced Genome Browser" />
    <meta name="author" content="Lei Kong, kongl@mail.cbi.pku.edu.cn" />

    <title>ABrowse - Advanced Genome Browser</title>

    <!-- Bootstrap core CSS -->
    <link rel='stylesheet' href='/webjars/bootstrap/4.5.2/css/bootstrap.min.css' />

    <!-- ABrowse core CSS -->
    <link rel="stylesheet" href="/css/abrowse.css" />

    <!-- Include JQuery and JQuery plugin scripts: -->
    <script src="/webjars/jquery/3.2.1/jquery.min.js"></script>
    <script src="/webjars/jquery-mousewheel/3.1.12/jquery.mousewheel.js"></script>

    <!-- Bootstrap core JavaScript -->
    <script src="/webjars/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- PLEASE USE abrowse-all.js in PRODUCTION ENVIRONMENT -->
    <script type="text/javascript" src="/js/abrowse/namespace.js"></script>
    <script type="text/javascript" src="/js/abrowse/minutiae.js"></script>
    <script type="text/javascript" src="/js/abrowse/genomebrowser.js"></script>
    <script type="text/javascript" src="/js/abrowse/trackoption.js"></script>
    <script type="text/javascript" src="/js/abrowse/view/view.js"></script>
    <script type="text/javascript" src="/js/abrowse/view/colorschema.js"></script>
    <script type="text/javascript" src="/js/abrowse/view/gene_model_like_view.js"></script>
    <script type="text/javascript" src="/js/abrowse/view/gene_model_like_dense_view.js"></script>
    <script type="text/javascript" src="/js/abrowse/view/bed_graph_view.js"></script>
    <script type="text/javascript" src="/js/abrowse/view/hiC_view.js"></script>
    <script type="text/javascript" src="/js/abrowse/view/strand_bed_graph_view.js"></script>
    <script type="text/javascript" src="/js/abrowse/view/rna_seq_raw_data_view.js"></script>
    <script type="text/javascript" src="/js/abrowse/view/rna_seq_splice_site_view.js"></script>
    <script type="text/javascript" src="/js/abrowse/gmap.js"></script>
    <script type="text/javascript" src="/js/abrowse/index.js"></script>

    <script th:inline="javascript">

      //  根据用户登陆权限 点击 icon 进入不同管理界面
        function enterPanel() {
          var isAdmins = [[${#authorization.expression('hasRole(''ROLE_ADMIN'')')}]];
          if (isAdmins) {
            window.location.href = '/admin/'
          } else {
            window.location.href = '/user/'
          }
        }

        function getParam(key){
            var results = new RegExp('[\?&]' + key + '=([^&#]*)').exec(window.location.href);
            if(results){
                return results[1];
            }else{
                return undefined;
            }
        }
        /*<![CDATA[*/
        $(function () {
            ABrowse.mainPageInit();
            ABrowse.defaultGenomeBrowser.changeSpecies();
            var pos = getParam("pos");
            if (pos) {

                if (! pos.match("^chr")) {
                    pos = "chr" + pos;
                }
                document.getElementById(ABrowse.defaultGenomeBrowser.searchInputId).value = pos;
            }
            ABrowse.defaultGenomeBrowser.submit();
        });
        function showImg(){
            var searchStr = $("#position").get(0).value;
            var chrLoc = ABrowse.parsePositionStr(searchStr);
            console.log(chrLoc);
            window.open("/HiC/init?chrName=" + chrLoc.chr + "&start=" + chrLoc.start + "&end=" + chrLoc.end , "_blank");
        }
        /*]]>*/
    </script>

</head>
<body>

<div id="header" style="width:100%; background:#ebebeb; padding: 5px 5px 5px 5px;">
    <table>
        <tr>
            <td><a style="font-weight: bolder; color: darkred; font-size: 130%;" href="">ABrowse</a></td>
            <td style="padding-left:10px; font-size:14px;">
                <input id="position" type="text" name="position"
                       value="chr1:11012386-11030886" size="30" />
            </td>
            <td style="padding-left:5px;">
                <select name="species" id="species_adv" class="selectpicker" onchange="ABrowse.defaultGenomeBrowser.changeGene();" th:value="${defGemo}">
                    <option th:each="configGenomeEntry : ${configGenomeMap}" th:value="${configGenomeEntry.value.name}" th:selected="${configGenomeEntry.value.name == defGemo}"
                            th:text="${configGenomeEntry.value.displayName}"></option>
                </select>
            </td>
            <td style="padding-left:15px;">
                <button type="button" class="btn btn-danger btn-sm" onclick="ABrowse.defaultGenomeBrowser.submit();">
                    GO
                </button>
                <button type="button" id="HiCBtn" class="btn btn-danger btn-sm" onclick="showImg()" style="display: none">
                    HiC
                </button>
            </td>
            <td style="padding-left:15px;">
                <button type="button" class="btn btn-light btn-sm" aria-label="Left Align">
<!--                    <span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span>-->
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                    </svg>
                </button>
                <button type="button" class="btn btn-light btn-sm" aria-label="Left Align">
<!--                    <span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span>-->
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                </button>
                <button type="button" class="btn btn-light btn-sm" aria-label="Left Align"
                        onclick="ABrowse.defaultGenomeBrowser.zoomInSubmit();">
<!--                    <span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span>-->
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-zoom-in" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                        <path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>
                        <path fill-rule="evenodd" d="M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z"/>
                    </svg>
                </button>
                <button type="button" class="btn btn-light btn-sm" aria-label="Left Align"
                        onclick="ABrowse.defaultGenomeBrowser.zoomOutSubmit();">
<!--                    <span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span>-->
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-zoom-out" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                        <path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>
                        <path fill-rule="evenodd" d="M3 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                    </svg>
                </button>
            </td>
            <td style="padding-left:15px;">
                <a sec:authorize="isAnonymous()" href="/login" type="button" class="btn btn-light btn-sm" aria-label="Left Align">
<!--                    <span class="glyphicon glyphicon-log-in" aria-hidden="true"></span>-->
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-box-arrow-in-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0v-2z"/>
                        <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                    </svg>
                    登录
                </a>
                <a type="button" class="btn btn-light btn-sm" aria-label="Left Align"
                   href="/">
<!--                    <span class="glyphicon glyphicon-user" aria-hidden="true"></span>-->
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-person-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                    </svg>
                </a>
                <a type="button" class="btn btn-light btn-sm" aria-label="Left Align"
                   onclick="enterPanel()">
<!--                    <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>-->
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-gear" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M8.837 1.626c-.246-.835-1.428-.835-1.674 0l-.094.319A1.873 1.873 0 0 1 4.377 3.06l-.292-.16c-.764-.415-1.6.42-1.184 1.185l.159.292a1.873 1.873 0 0 1-1.115 2.692l-.319.094c-.835.246-.835 1.428 0 1.674l.319.094a1.873 1.873 0 0 1 1.115 2.693l-.16.291c-.415.764.42 1.6 1.185 1.184l.292-.159a1.873 1.873 0 0 1 2.692 1.116l.094.318c.246.835 1.428.835 1.674 0l.094-.319a1.873 1.873 0 0 1 2.693-1.115l.291.16c.764.415 1.6-.42 1.184-1.185l-.159-.291a1.873 1.873 0 0 1 1.116-2.693l.318-.094c.835-.246.835-1.428 0-1.674l-.319-.094a1.873 1.873 0 0 1-1.115-2.692l.16-.292c.415-.764-.42-1.6-1.185-1.184l-.291.159A1.873 1.873 0 0 1 8.93 1.945l-.094-.319zm-2.633-.283c.527-1.79 3.065-1.79 3.592 0l.094.319a.873.873 0 0 0 1.255.52l.292-.16c1.64-.892 3.434.901 2.54 2.541l-.159.292a.873.873 0 0 0 .52 1.255l.319.094c1.79.527 1.79 3.065 0 3.592l-.319.094a.873.873 0 0 0-.52 1.255l.16.292c.893 1.64-.902 3.434-2.541 2.54l-.292-.159a.873.873 0 0 0-1.255.52l-.094.319c-.527 1.79-3.065 1.79-3.592 0l-.094-.319a.873.873 0 0 0-1.255-.52l-.292.16c-1.64.893-3.433-.902-2.54-2.541l.159-.292a.873.873 0 0 0-.52-1.255l-.319-.094c-1.79-.527-1.79-3.065 0-3.592l.319-.094a.873.873 0 0 0 .52-1.255l-.16-.292c-.892-1.64.902-3.433 2.541-2.54l.292.159a.873.873 0 0 0 1.255-.52l.094-.319z"/>
                        <path fill-rule="evenodd" d="M8 5.754a2.246 2.246 0 1 0 0 4.492 2.246 2.246 0 0 0 0-4.492zM4.754 8a3.246 3.246 0 1 1 6.492 0 3.246 3.246 0 0 1-6.492 0z"/>
                    </svg>
                </a>
                <a sec:authorize="isAuthenticated()" href="/logout" type="button" class="btn btn-light btn-sm" aria-label="Left Align">
<!--                    <span class="glyphicon glyphicon-log-out" aria-hidden="true"></span>-->
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-box-arrow-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                        <path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                    </svg>
                    退出 <span sec:authentication="name"></span>
                </a>
            </td>
        </tr>
    </table>
</div>
<div id="browser" onselectstart="return false;"></div>
<div id="progressbar"></div>

<span id="showIcon" class="glyphicon glyphicon-menu-hamburger cursor-pointer" aria-hidden="true" onclick="showTool()" style="font-size: 70%;float:right;top:8px;right:3px;display: none;"></span>

<div id="statuspanel" style="font-size: 70%; overflow:scroll; ">

  <span id="hideIcon" class="glyphicon glyphicon-menu-hamburger cursor-pointer" aria-hidden="true" onclick="hideTool()" style="position:fixed;margin-top:45px;"></span>

    <ul id="statusPanelTab" class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link active" href="#statuspanel-tracklist" data-toggle="tab">
                Tracks
            </a>
        </li>
        <li class="nav-item"><a class="nav-link" href="#statuspanel-info" data-toggle="tab">信息</a></li>
        <li class="nav-item"><a class="nav-link" href="#statuspanel-bookmark" data-toggle="tab">搜索</a></li>
    </ul>
    <div id="statusPanelTabContent" class="tab-content" style="padding: 5px 0 0 0;">
        <div role="tabpanel" class="tab-pane fade active" id="statuspanel-tracklist">
            <div class="accordion" th:each="trackGroupEntry : ${configGenome.trackGroupMap}" id="accordion" role="tablist" aria-multiselectable="true">
                <div  class="card">
                    <div class="card-header" role="tab" id="headingOne">
                        <h5 class="panel-title" >
                            <a th:text="${trackGroupEntry.value.displayName}" role="button" data-toggle="collapse" data-parent="#accordion"
                               th:href="'#' + ${trackGroupEntry.value.name}" aria-expanded="true" th:attr="aria-controls=${trackGroupEntry.value.name}"
                            style="font-size: 12px;color: black">
                                Gene
                            </a>
                        </h5>
                    </div>
                    <div th:id="${trackGroupEntry.value.name}" class="collapse show list-group" role="tabpanel" aria-labelledby="headingOne">
                        <div th:each="trackEntry : ${trackGroupEntry.value.trackMap}" class="list-group-item">
                            <h6 th:text="${trackEntry.value.displayName}" style="font-size: 12px">Ensembl Gene</h6>
                            <div class="btn-group btn-group-sm" data-toggle="buttons">
                                <label th:each="view : ${trackEntry.value.views}" th:title="${trackGroupEntry.value.name}"
                                       th:class="(${view.viewName} eq ${trackEntry.value.defaultNormalView}) ? 'btn btn-danger active' : 'btn btn-danger'"
                                       style="padding: 3px 5px 3px 5px;">
                                    <input th:if="${view.viewName} eq ${trackEntry.value.defaultNormalView}" type="radio" autocomplete="off" checked="checked"
                                           th:value="${view.viewName}" th:name="${trackEntry.value.name}"
                                           onchange="ABrowse.defaultGenomeBrowser.trackOption.trackViewOnChecked(this);"
                                           class="viewtype" style="-webkit-appearance:none;"/>
                                    <input th:if="${view.viewName} ne ${trackEntry.value.defaultNormalView}" type="radio" autocomplete="off"
                                           th:value="${view.viewName}" th:name="${trackEntry.value.name}"
                                           onchange="ABrowse.defaultGenomeBrowser.trackOption.trackViewOnChecked(this);"
                                           class="viewtype" style="-webkit-appearance:none;"/>
                                    <span th:text="${configGenome.viewMap.get(view.viewName).type}" style=" font-size: 10px;"></span>
                                </label>
                                <label class="btn btn-danger" style="padding: 3px 5px 3px 5px;">
                                    <input type="radio" th:attr="role=${trackGroupEntry.value.name}" th:name="${trackEntry.value.name}" autocomplete="off" value="off"
                                           onchange="ABrowse.defaultGenomeBrowser.trackOption.trackViewOnChecked(this);"
                                           class="viewtype" style="-webkit-appearance:none;"/><span style=" font-size: 10px;">off</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel"  class="tab-pane fade " id="statuspanel-info">
            <p>开发中：基因/转录本/蛋白质等信息页面</p>
        </div>
        <div role="tabpanel"  class="tab-pane fade " id="statuspanel-bookmark">
            <div>
                <textarea style="width: 100%;height: 100px"></textarea>
            </div>

        </div>
    </div>

</div>

</body>
</html>
